<html lang="zh-TW"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImYwZjI0YjNjZGNmMjUwNzA5NWVlMDNmZWQxYWExYzRjYzFjZjZlY2MiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwNjM4MTMwNDQxMjcwNTkyNTkxNyIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiIzYzk5NDk0MTVhMjYt5Y6f56eR6Kej5a-G77ya5aSx6JC955qE6K6K5ZugL2luZGV4Lmh0bWwtOTgxIn0sImV4cCI6MTc2NDQxNTQ4MywiaWF0IjoxNzY0NDExODgzLCJhbGciOiJSUzI1NiJ9.hWjzGfnUaUW4yWrVXjgndnA6k31nuYWwJgAfxqgA2eSNA4R5Vh49MioVbLHpF9I8pU8YPTnIc6-VAM6RZ7jfUKtdotwgjI_owwyLFdJbXjjwy_VKq1AjF-eMQGYG1-o3BJSDcO9cFLXZdMcY5669bFwaQBVrq6VwXyt9kSXesY4xa2EqxjfYwWPF9fVgBpa8VYM6T7Tw2qOma6mnTxkxHK-FEJCABhNIX4t1ECcBp5O0fgCdFrCdlZfFY8UQVbhh4Hw4Ea4TQgRzipryF9Q_L7nkFM2I-VZ_NTsWIsX3lEGfdDbg1d_radi9R3NgH2q21IyQVqKTtCr-OL4_ew5ppA","3c9949415a26-原科解密：失落的變因/index.html-981")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>原科解密：失落的變因 | Indigenous Science Decoded</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&amp;family=Chakra+Petch:wght@400;600&amp;display=swap" rel="stylesheet">
    
    <style>
        /* --- 基礎設定 --- */
        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #0c0a09; /* Warm Dark */
            color: #e7e5e4;
            /* 復古紙張紋理背景 */
            background-image: 
                linear-gradient(rgba(12, 10, 9, 0.85), rgba(12, 10, 9, 0.85)),
                url('https://images.unsplash.com/photo-1586075010999-9bc0c4103632?q=80&w=2000&auto=format&fit=crop');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }

        /* 字體微調 */
        .font-tech { font-family: 'Chakra Petch', sans-serif; }

        /* --- 動畫系統 --- */
        .fade-in { animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .slide-up { animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        
        @keyframes fadeIn { from { opacity: 0; filter: blur(4px); } to { opacity: 1; filter: blur(0); } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- 地圖節點 (Glassmorphism + Retro) --- */
        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
        }
        .map-node {
            background: rgba(28, 25, 23, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(120, 113, 108, 0.2);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .map-node:not(.locked):hover {
            transform: translateY(-5px);
            border-color: rgba(217, 119, 6, 0.5); /* Amber */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 0 15px rgba(217, 119, 6, 0.2);
        }
        .locked {
            filter: grayscale(100%) opacity(40%);
            cursor: not-allowed;
        }
        
        /* --- 圖片復古濾鏡 (關鍵修正) --- */
        /* 將真實照片轉化為類似手繪/舊照片的風格 */
        .retro-img {
            filter: sepia(0.6) contrast(1.1) grayscale(0.4) brightness(0.9);
            mix-blend-mode: normal;
            transition: all 0.5s ease;
            border-radius: 8px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .retro-img:hover {
            filter: sepia(0.3) contrast(1.0) grayscale(0) brightness(1.0); /* Hover 時稍微還原色彩 */
        }
        
        /* --- 互動元素 --- */
        .drop-zone { transition: all 0.3s ease; min-height: 160px; }
        .drop-zone.hovered { 
            background: rgba(16, 185, 129, 0.15); 
            border-color: #34d399; 
        }
        .plant-card.selected { 
            border-color: #fbbf24; 
            box-shadow: 0 0 0 2px #fbbf24, 0 10px 15px -3px rgba(0,0,0,0.5);
            transform: translateY(-2px);
        }
        
        /* --- 山豬動畫 --- */
        @keyframes boarMove {
            0% { left: -150px; opacity: 0; transform: scaleX(-1); }
            20% { left: 35%; opacity: 1; transform: scaleX(-1); }
            45% { left: 45%; transform: scaleX(-1) rotate(5deg); }
            50% { left: 45%; transform: scaleX(-1) rotate(-5deg); }
            100% { left: 45%; opacity: 1; transform: scaleX(-1); }
        }
        @keyframes boarRun {
            0% { left: 45%; transform: scaleX(1); opacity: 1; }
            100% { left: 120%; transform: scaleX(1); opacity: 0; }
        }
        @keyframes boarHit {
            0% { transform: scaleX(-1) scaleY(1); }
            50% { transform: scaleX(-1) scaleY(0.6); filter: brightness(2) sepia(1); }
            100% { transform: scaleX(-1) scaleY(0.8) rotate(180deg); opacity: 0.8; bottom: 10px; }
        }
        
        .boar-anim-enter { animation: boarMove 4s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
        .boar-anim-run { animation: boarRun 1.5s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards; }
        .boar-anim-hit { animation: boarHit 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        /* 滾動條美化 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(28, 25, 23, 0.5); }
        ::-webkit-scrollbar-thumb { background: #57534e; border-radius: 10px; }
        
        /* 玻璃擬態 Modal */
        .glass-modal {
            background: rgba(23, 23, 23, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        .hidden { display: none !important; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.-inset-1{inset:-0.25rem}.inset-0{inset:0px}.-top-4{top:-1rem}.bottom-0{bottom:0px}.left-0{left:0px}.left-3{left:0.75rem}.right-0{right:0px}.right-3{right:0.75rem}.right-4{right:1rem}.top-0{top:0px}.top-3{top:0.75rem}.top-4{top:1rem}.z-10{z-index:10}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[110\]{z-index:110}.z-\[120\]{z-index:120}.col-span-full{grid-column:1 / -1}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-1{margin-left:0.25rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.hidden{display:none}.h-10{height:2.5rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:0.5rem}.h-20{height:5rem}.h-56{height:14rem}.h-6{height:1.5rem}.h-\[80vh\]{height:80vh}.h-full{height:100%}.h-px{height:1px}.max-h-\[85vh\]{max-height:85vh}.min-h-\[60vh\]{min-height:60vh}.min-h-\[80vh\]{min-height:80vh}.min-h-screen{min-height:100vh}.w-0{width:0px}.w-1\.5{width:0.375rem}.w-10{width:2.5rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-20{width:5rem}.w-24{width:6rem}.w-3\/4{width:75%}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-lg{max-width:32rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.scale-95{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-5{gap:1.25rem}.gap-6{gap:1.5rem}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-t-4{border-top-width:4px}.border-amber-600\/30{border-color:rgb(217 119 6 / 0.3)}.border-amber-700\/50{border-color:rgb(180 83 9 / 0.5)}.border-cyan-800\/50{border-color:rgb(21 94 117 / 0.5)}.border-emerald-800\/50{border-color:rgb(6 95 70 / 0.5)}.border-orange-800\/50{border-color:rgb(154 52 18 / 0.5)}.border-pink-800\/50{border-color:rgb(157 23 77 / 0.5)}.border-purple-800\/50{border-color:rgb(107 33 168 / 0.5)}.border-stone-700{--tw-border-opacity:1;border-color:rgb(68 64 60 / var(--tw-border-opacity, 1))}.border-stone-800{--tw-border-opacity:1;border-color:rgb(41 37 36 / var(--tw-border-opacity, 1))}.border-white\/10{border-color:rgb(255 255 255 / 0.1)}.border-white\/5{border-color:rgb(255 255 255 / 0.05)}.border-yellow-800\/50{border-color:rgb(133 77 14 / 0.5)}.border-t-amber-600{--tw-border-opacity:1;border-top-color:rgb(217 119 6 / var(--tw-border-opacity, 1))}.bg-amber-600{--tw-bg-opacity:1;background-color:rgb(217 119 6 / var(--tw-bg-opacity, 1))}.bg-amber-700{--tw-bg-opacity:1;background-color:rgb(180 83 9 / var(--tw-bg-opacity, 1))}.bg-amber-900\/20{background-color:rgb(120 53 15 / 0.2)}.bg-black\/20{background-color:rgb(0 0 0 / 0.2)}.bg-black\/40{background-color:rgb(0 0 0 / 0.4)}.bg-black\/80{background-color:rgb(0 0 0 / 0.8)}.bg-black\/90{background-color:rgb(0 0 0 / 0.9)}.bg-cyan-900\/10{background-color:rgb(22 78 99 / 0.1)}.bg-emerald-900\/10{background-color:rgb(6 78 59 / 0.1)}.bg-orange-900\/10{background-color:rgb(124 45 18 / 0.1)}.bg-pink-900\/10{background-color:rgb(131 24 67 / 0.1)}.bg-purple-900\/10{background-color:rgb(88 28 135 / 0.1)}.bg-stone-700{--tw-bg-opacity:1;background-color:rgb(68 64 60 / var(--tw-bg-opacity, 1))}.bg-stone-800{--tw-bg-opacity:1;background-color:rgb(41 37 36 / var(--tw-bg-opacity, 1))}.bg-stone-800\/50{background-color:rgb(41 37 36 / 0.5)}.bg-stone-900{--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1))}.bg-stone-900\/80{background-color:rgb(28 25 23 / 0.8)}.bg-stone-900\/90{background-color:rgb(28 25 23 / 0.9)}.bg-stone-950{--tw-bg-opacity:1;background-color:rgb(12 10 9 / var(--tw-bg-opacity, 1))}.bg-stone-950\/50{background-color:rgb(12 10 9 / 0.5)}.bg-stone-950\/90{background-color:rgb(12 10 9 / 0.9)}.bg-white\/5{background-color:rgb(255 255 255 / 0.05)}.bg-yellow-900\/10{background-color:rgb(113 63 18 / 0.1)}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.bg-gradient-to-t{background-image:linear-gradient(to top, var(--tw-gradient-stops))}.from-amber-700{--tw-gradient-from:#b45309 var(--tw-gradient-from-position);--tw-gradient-to:rgb(180 83 9 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-amber-800{--tw-gradient-from:#92400e var(--tw-gradient-from-position);--tw-gradient-to:rgb(146 64 14 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-amber-900{--tw-gradient-from:#78350f var(--tw-gradient-from-position);--tw-gradient-to:rgb(120 53 15 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-amber-900\/30{--tw-gradient-from:rgb(120 53 15 / 0.3) var(--tw-gradient-from-position);--tw-gradient-to:rgb(120 53 15 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-black\/90{--tw-gradient-from:rgb(0 0 0 / 0.9) var(--tw-gradient-from-position);--tw-gradient-to:rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-stone-950{--tw-gradient-from:#0c0a09 var(--tw-gradient-from-position);--tw-gradient-to:rgb(12 10 9 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-transparent{--tw-gradient-from:transparent var(--tw-gradient-from-position);--tw-gradient-to:rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.via-amber-700{--tw-gradient-to:rgb(180 83 9 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #b45309 var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-orange-600{--tw-gradient-to:rgb(234 88 12 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #ea580c var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-stone-800{--tw-gradient-to:rgb(41 37 36 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), #292524 var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-stone-950\/60{--tw-gradient-to:rgb(12 10 9 / 0)  var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), rgb(12 10 9 / 0.6) var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-amber-500{--tw-gradient-to:#f59e0b var(--tw-gradient-to-position)}.to-amber-700{--tw-gradient-to:#b45309 var(--tw-gradient-to-position)}.to-amber-900\/30{--tw-gradient-to:rgb(120 53 15 / 0.3) var(--tw-gradient-to-position)}.to-stone-900{--tw-gradient-to:#1c1917 var(--tw-gradient-to-position)}.to-transparent{--tw-gradient-to:transparent var(--tw-gradient-to-position)}.bg-cover{background-size:cover}.bg-center{background-position:center}.object-cover{object-fit:cover}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-8{padding-left:2rem;padding-right:2rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-3\.5{padding-top:0.875rem;padding-bottom:0.875rem}.pb-12{padding-bottom:3rem}.pb-20{padding-bottom:5rem}.pl-10{padding-left:2.5rem}.pt-24{padding-top:6rem}.pt-8{padding-top:2rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-justify{text-align:justify}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.font-serif{font-family:ui-serif, Georgia, Cambria, "Times New Roman", Times, serif}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[10px\]{font-size:10px}.text-\[9px\]{font-size:9px}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-light{font-weight:300}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-8{line-height:2rem}.leading-relaxed{line-height:1.625}.tracking-\[0\.2em\]{letter-spacing:0.2em}.tracking-\[0\.3em\]{letter-spacing:0.3em}.tracking-tight{letter-spacing:-0.025em}.tracking-wide{letter-spacing:0.025em}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-amber-100{--tw-text-opacity:1;color:rgb(254 243 199 / var(--tw-text-opacity, 1))}.text-amber-500{--tw-text-opacity:1;color:rgb(245 158 11 / var(--tw-text-opacity, 1))}.text-amber-600\/80{color:rgb(217 119 6 / 0.8)}.text-cyan-600\/80{color:rgb(8 145 178 / 0.8)}.text-emerald-500{--tw-text-opacity:1;color:rgb(16 185 129 / var(--tw-text-opacity, 1))}.text-emerald-500\/80{color:rgb(16 185 129 / 0.8)}.text-emerald-600\/80{color:rgb(5 150 105 / 0.8)}.text-orange-600\/80{color:rgb(234 88 12 / 0.8)}.text-pink-600\/80{color:rgb(219 39 119 / 0.8)}.text-purple-600\/80{color:rgb(147 51 234 / 0.8)}.text-stone-200{--tw-text-opacity:1;color:rgb(231 229 228 / var(--tw-text-opacity, 1))}.text-stone-300{--tw-text-opacity:1;color:rgb(214 211 209 / var(--tw-text-opacity, 1))}.text-stone-400{--tw-text-opacity:1;color:rgb(168 162 158 / var(--tw-text-opacity, 1))}.text-stone-500{--tw-text-opacity:1;color:rgb(120 113 108 / var(--tw-text-opacity, 1))}.text-stone-600{--tw-text-opacity:1;color:rgb(87 83 78 / var(--tw-text-opacity, 1))}.text-stone-700{--tw-text-opacity:1;color:rgb(68 64 60 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-600\/80{color:rgb(202 138 4 / 0.8)}.placeholder-stone-700::placeholder{--tw-placeholder-opacity:1;color:rgb(68 64 60 / var(--tw-placeholder-opacity, 1))}.opacity-0{opacity:0}.opacity-20{opacity:0.2}.opacity-50{opacity:0.5}.opacity-70{opacity:0.7}.opacity-90{opacity:0.9}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(245\2c 158\2c 11\2c 0\.3\)\]{--tw-shadow:0 0 10px rgba(245,158,11,0.3);--tw-shadow-colored:0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:inset 0 2px 4px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.blur{--tw-blur:blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.blur-xl{--tw-blur:blur(24px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-lg{--tw-drop-shadow:drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow:drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale:grayscale(100%);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur:blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur:blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-1000{transition-duration:1000ms}.duration-300{transition-duration:300ms}.duration-500{transition-duration:500ms}.duration-700{transition-duration:700ms}.ease-out{transition-timing-function:cubic-bezier(0, 0, 0.2, 1)}.selection\:bg-amber-900\/50 *::selection{background-color:rgb(120 53 15 / 0.5)}.selection\:bg-amber-900\/50::selection{background-color:rgb(120 53 15 / 0.5)}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-\[1\.02\]:hover{--tw-scale-x:1.02;--tw-scale-y:1.02;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-amber-600:hover{--tw-border-opacity:1;border-color:rgb(217 119 6 / var(--tw-border-opacity, 1))}.hover\:bg-stone-600:hover{--tw-bg-opacity:1;background-color:rgb(87 83 78 / var(--tw-bg-opacity, 1))}.hover\:bg-stone-700:hover{--tw-bg-opacity:1;background-color:rgb(68 64 60 / var(--tw-bg-opacity, 1))}.hover\:bg-stone-800:hover{--tw-bg-opacity:1;background-color:rgb(41 37 36 / var(--tw-bg-opacity, 1))}.hover\:bg-white\/10:hover{background-color:rgb(255 255 255 / 0.1)}.hover\:from-amber-700:hover{--tw-gradient-from:#b45309 var(--tw-gradient-from-position);--tw-gradient-to:rgb(180 83 9 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:to-amber-600:hover{--tw-gradient-to:#d97706 var(--tw-gradient-to-position)}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.focus\:border-amber-500:focus{--tw-border-opacity:1;border-color:rgb(245 158 11 / var(--tw-border-opacity, 1))}.focus\:border-amber-600:focus{--tw-border-opacity:1;border-color:rgb(217 119 6 / var(--tw-border-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-1:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-amber-500\/50:focus{--tw-ring-color:rgb(245 158 11 / 0.5)}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:border-cyan-500{--tw-border-opacity:1;border-color:rgb(6 182 212 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:border-emerald-500{--tw-border-opacity:1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:border-orange-500{--tw-border-opacity:1;border-color:rgb(249 115 22 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:border-pink-500{--tw-border-opacity:1;border-color:rgb(236 72 153 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:border-yellow-500{--tw-border-opacity:1;border-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.group:hover .group-hover\:bg-cyan-900\/20{background-color:rgb(22 78 99 / 0.2)}.group:hover .group-hover\:bg-emerald-900\/20{background-color:rgb(6 78 59 / 0.2)}.group:hover .group-hover\:bg-orange-900\/20{background-color:rgb(124 45 18 / 0.2)}.group:hover .group-hover\:bg-pink-900\/20{background-color:rgb(131 24 67 / 0.2)}.group:hover .group-hover\:bg-purple-900\/20{background-color:rgb(88 28 135 / 0.2)}.group:hover .group-hover\:bg-yellow-900\/20{background-color:rgb(113 63 18 / 0.2)}.group:hover .group-hover\:text-cyan-400{--tw-text-opacity:1;color:rgb(34 211 238 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-emerald-400{--tw-text-opacity:1;color:rgb(52 211 153 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-orange-400{--tw-text-opacity:1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-pink-400{--tw-text-opacity:1;color:rgb(244 114 182 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-purple-400{--tw-text-opacity:1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:opacity-40{opacity:0.4}.group:hover .group-hover\:opacity-75{opacity:0.75}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(16\2c 185\2c 129\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(16,185,129,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(168\2c 85\2c 247\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(168,85,247,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(234\2c 179\2c 8\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(234,179,8,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(236\2c 72\2c 153\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(236,72,153,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(249\2c 115\2c 22\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(249,115,22,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-\[0_0_15px_rgba\(6\2c 182\2c 212\2c 0\.2\)\]{--tw-shadow:0 0 15px rgba(6,182,212,0.2);--tw-shadow-colored:0 0 15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group:hover .group-hover\:shadow-amber-900\/30{--tw-shadow-color:rgb(120 53 15 / 0.3);--tw-shadow:var(--tw-shadow-colored)}@media (min-width: 640px){.sm\:inline{display:inline}}@media (min-width: 768px){.md\:block{display:block}.md\:w-32{width:8rem}.md\:flex-row{flex-direction:row}.md\:text-5xl{font-size:3rem;line-height:1}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}}</style></head>
<body class="min-h-screen flex flex-col overflow-x-hidden selection:bg-amber-900/50">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 bg-stone-950/90 backdrop-blur-md border-b border-stone-800 shadow-2xl transition-all duration-300">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4 group cursor-pointer" onclick="returnToMap()">
                <div class="relative w-10 h-10 flex items-center justify-center">
                    <div class="absolute inset-0 bg-amber-600 rounded-full blur opacity-20 group-hover:opacity-40 transition-opacity"></div>
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-900 to-stone-900 flex items-center justify-center border border-amber-700/50 shadow-inner relative z-10">
                        <span class="material-symbols-outlined text-amber-500 group-hover:scale-110 transition-transform">science</span>
                    </div>
                </div>
                <div>
                    <h1 class="text-lg md:text-xl font-bold text-amber-500 tracking-wider font-serif">原科解密</h1>
                    <p class="text-[10px] text-stone-500 uppercase tracking-[0.3em] font-tech">Indigenous Science</p>
                </div>
            </div>
            
            <div class="flex items-center gap-6">
                <button onclick="viewSource()" class="flex items-center gap-2 text-xs font-tech text-stone-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-full border border-white/10" title="檢視原始碼">
                    <span class="material-symbols-outlined text-sm">code</span>
                    <span class="hidden sm:inline">Source</span>
                </button>

                <div class="hidden md:block text-right">
                    <div class="text-[9px] text-stone-600 uppercase tracking-widest font-bold">HUNTER TEAM</div>
                    <div class="text-sm text-emerald-500/80 font-tech animate-pulse" id="team-display">OFFLINE</div>
                </div>
                <!-- Progress Bar -->
                <div class="w-24 md:w-32 h-2 bg-stone-900 rounded-full overflow-hidden border border-white/5">
                    <div class="h-full bg-gradient-to-r from-amber-700 via-orange-600 to-amber-500 w-0 transition-all duration-1000 ease-out shadow-[0_0_10px_rgba(245,158,11,0.3)]" id="global-progress"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-4 max-w-6xl mx-auto w-full relative z-10">
        
        <!-- STAGE 0: LOGIN -->
        <section class="min-h-[80vh] flex flex-col items-center justify-center fade-in" id="stage-login">
            <div class="relative w-full max-w-lg group">
                <div class="absolute -inset-1 bg-gradient-to-r from-amber-900/30 via-stone-800 to-amber-900/30 rounded-2xl blur-xl opacity-50 group-hover:opacity-75 transition duration-1000"></div>
                
                <div class="relative glass-modal p-8 rounded-2xl text-center border border-stone-700">
                    <div class="mb-8 relative overflow-hidden rounded-xl border border-stone-800 shadow-lg">
                        <!-- 圖片：復古地圖 -->
                        <img class="w-full h-56 object-cover retro-img" src="https://images.unsplash.com/photo-1524661135-423995f22d0b?q=80&amp;w=800&amp;auto=format&amp;fit=crop" alt="Ancient Map">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 to-transparent">
                            <h2 class="text-3xl font-bold text-amber-500 mb-1 drop-shadow-md font-serif">獵人召集令</h2>
                            <p class="text-stone-400 italic text-xs font-serif opacity-90">「科學的火種散落在部落的角落...」</p>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="text-left">
                            <label class="text-xs text-amber-600/80 uppercase font-bold tracking-widest font-tech ml-1">Team Identity</label>
                            <div class="relative mt-2">
                                <span class="material-symbols-outlined absolute left-3 top-3 text-stone-500">badge</span>
                                <input class="w-full bg-black/40 border border-stone-700 text-center text-amber-100 p-3 pl-10 rounded-lg focus:ring-1 focus:ring-amber-500/50 focus:border-amber-600 focus:outline-none font-serif transition-all placeholder-stone-700" id="team-name" placeholder="輸入獵人小隊名稱" type="text" autocomplete="off">
                            </div>
                        </div>
                        <button class="w-full bg-gradient-to-r from-amber-800 to-amber-700 hover:from-amber-700 hover:to-amber-600 text-stone-200 hover:text-white font-bold py-3.5 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-all transform hover:scale-[1.02] border border-white/5 group-hover:shadow-amber-900/30" onclick="startGame()">
                            <span class="material-symbols-outlined">fingerprint</span> 
                            <span class="tracking-widest">啟動任務</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- STAGE 1: THE MAP HUB -->
        <section class="hidden fade-in" id="stage-map">
            <div class="text-center mb-12 relative">
                <div class="inline-block relative">
                    <h2 class="text-4xl md:text-5xl font-bold text-stone-200 mb-2 tracking-tight drop-shadow-lg font-serif">失落的變因地圖</h2>
                    <div class="h-px w-3/4 bg-gradient-to-r from-transparent via-amber-700 to-transparent mx-auto mt-4 opacity-70"></div>
                </div>
                <p class="text-stone-500 mt-4 font-tech tracking-wide text-sm">ACCESS GRANTED. SELECT A SECTOR.</p>
            </div>
            
            <div class="map-grid px-2">
                <!-- Taxonomy -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-taxonomy" onclick="enterLevel('taxonomy')">
                    <div class="absolute inset-0 bg-emerald-900/10 group-hover:bg-emerald-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-emerald-800/50 group-hover:border-emerald-500 group-hover:shadow-[0_0_15px_rgba(16,185,129,0.2)] transition-all">
                        <span class="material-symbols-outlined text-emerald-600/80 group-hover:text-emerald-400 text-3xl transition-colors">forest</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-emerald-400 transition-colors font-serif">分類迷宮</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Botany</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-taxonomy"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- Trap -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-trap" onclick="enterLevel('trap')">
                    <div class="absolute inset-0 bg-orange-900/10 group-hover:bg-orange-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-orange-800/50 group-hover:border-orange-500 group-hover:shadow-[0_0_15px_rgba(249,115,22,0.2)] transition-all">
                        <span class="material-symbols-outlined text-orange-600/80 group-hover:text-orange-400 text-3xl transition-colors">hardware</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-orange-400 transition-colors font-serif">重力陷阱</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Physics</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-trap"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- Pharmacy -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-pharmacy" onclick="enterLevel('pharmacy')">
                    <div class="absolute inset-0 bg-purple-900/10 group-hover:bg-purple-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-purple-800/50 group-hover:border-purple-500 group-hover:shadow-[0_0_15px_rgba(168,85,247,0.2)] transition-all">
                        <span class="material-symbols-outlined text-purple-600/80 group-hover:text-purple-400 text-3xl transition-colors">science</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-purple-400 transition-colors font-serif">石菖蒲煉金</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Chemistry</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-pharmacy"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- Granary -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-granary" onclick="enterLevel('granary')">
                    <div class="absolute inset-0 bg-yellow-900/10 group-hover:bg-yellow-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-yellow-800/50 group-hover:border-yellow-500 group-hover:shadow-[0_0_15px_rgba(234,179,8,0.2)] transition-all">
                        <span class="material-symbols-outlined text-yellow-600/80 group-hover:text-yellow-400 text-3xl transition-colors">home_work</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-yellow-400 transition-colors font-serif">呼吸穀倉</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Structure</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-granary"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- Dye -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-dye" onclick="enterLevel('dye')">
                    <div class="absolute inset-0 bg-pink-900/10 group-hover:bg-pink-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-pink-800/50 group-hover:border-pink-500 group-hover:shadow-[0_0_15px_rgba(236,72,153,0.2)] transition-all">
                        <span class="material-symbols-outlined text-pink-600/80 group-hover:text-pink-400 text-3xl transition-colors">palette</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-pink-400 transition-colors font-serif">大地調色</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Pigment</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-dye"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- River -->
                <button class="map-node p-5 rounded-xl flex flex-col items-center gap-3 group relative overflow-hidden" id="btn-river" onclick="enterLevel('river')">
                    <div class="absolute inset-0 bg-cyan-900/10 group-hover:bg-cyan-900/20 transition-colors"></div>
                    <div class="relative z-10 w-14 h-14 bg-stone-900 rounded-full flex items-center justify-center border border-cyan-800/50 group-hover:border-cyan-500 group-hover:shadow-[0_0_15px_rgba(6,182,212,0.2)] transition-all">
                        <span class="material-symbols-outlined text-cyan-600/80 group-hover:text-cyan-400 text-3xl transition-colors">water_drop</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="font-bold text-stone-300 text-base group-hover:text-cyan-400 transition-colors font-serif">溪流實驗</h3>
                        <p class="text-[9px] text-stone-600 uppercase tracking-widest font-tech mt-1">Analysis</p>
                    </div>
                    <div class="hidden absolute top-3 right-3 text-emerald-500 drop-shadow-glow" id="check-river"><span class="material-symbols-outlined text-lg">check_circle</span></div>
                </button>

                <!-- Final (Span Full) -->
                <button class="map-node locked col-span-full p-6 rounded-2xl flex flex-col items-center justify-center gap-4 relative overflow-hidden border-stone-800 transition-all duration-700" id="btn-final" onclick="enterLevel('final')">
                    <!-- 圖片：火/圖騰 (CSS 濾鏡復古化) -->
                    <div class="absolute inset-0 bg-cover bg-center opacity-20 grayscale transition-all duration-700 retro-img" id="final-bg" style="background-image: url('https://images.unsplash.com/photo-1544211333-662991e5c2fa?q=80&amp;w=1200&amp;auto=format&amp;fit=crop');"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-stone-950 via-stone-950/60 to-transparent"></div>
                    
                    <div class="relative z-10 w-16 h-16 bg-stone-900 rounded-full flex items-center justify-center border border-stone-700 text-stone-600 transition-all duration-500 shadow-2xl" id="final-icon-container">
                        <span class="material-symbols-outlined text-3xl" id="final-icon">lock</span>
                    </div>
                    <div class="relative z-10 text-center">
                        <h3 class="text-xl font-bold text-stone-500 tracking-wider transition-colors duration-500 font-serif" id="final-text">海神的試煉</h3>
                        <p class="text-[10px] text-stone-700 uppercase tracking-[0.2em] mt-1 font-tech">Access Denied</p>
                    </div>
                </button>
            </div>
        </section>

        <!-- LEVEL CONTAINER -->
        <section class="hidden fade-in relative min-h-[60vh] pb-20" id="level-container">
            <!-- Back Button -->
            <button class="absolute -top-4 right-0 z-50 text-stone-400 hover:text-white flex items-center gap-2 text-sm bg-stone-900/90 px-4 py-2 rounded-full border border-stone-700 hover:border-amber-600 hover:bg-stone-800 transition-all shadow-lg backdrop-blur" onclick="returnToMap()">
                <span class="material-symbols-outlined text-lg">grid_view</span> 
                <span class="font-tech tracking-wide">MAP</span>
            </button>
            <div class="pt-8" id="level-content">
                <!-- Content Injected via JS -->
            </div>
        </section>
    </main>

    <!-- Generic Feedback Modal -->
    <div class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity duration-300" id="modal">
        <div class="glass-modal rounded-2xl p-8 max-w-sm w-full relative transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
            <button class="absolute top-4 right-4 text-stone-500 hover:text-white transition-colors" onclick="closeModal()">
                <span class="material-symbols-outlined">close</span>
            </button>
            <div class="mb-6 flex justify-center">
                <div class="w-20 h-20 rounded-full bg-stone-800/50 flex items-center justify-center border border-white/5" id="modal-icon-bg">
                    <div id="modal-icon"></div>
                </div>
            </div>
            <h3 class="text-2xl font-bold text-center mb-3 tracking-wide font-serif" id="modal-title"></h3>
            <div class="text-stone-300 text-sm leading-relaxed mb-8 bg-black/20 p-4 rounded-lg border border-white/5 text-justify font-serif" id="modal-body"></div>
            <button class="w-full bg-stone-800 hover:bg-stone-700 text-white font-bold py-3 rounded-lg transition-all border border-white/10 hover:shadow-lg" onclick="closeModal()">確認狀態</button>
        </div>
    </div>

    <!-- Education Modal -->
    <div class="hidden fixed inset-0 z-[110] bg-black/90 backdrop-blur-md flex items-center justify-center p-4" id="edu-modal">
        <div class="glass-modal rounded-2xl max-w-2xl w-full relative flex flex-col max-h-[85vh] overflow-hidden border-t-4 border-t-amber-600 animate-slide-up">
            <!-- Header -->
            <div class="bg-stone-900/80 p-6 border-b border-white/10 flex items-center gap-5">
                <div class="p-3 bg-amber-900/20 rounded-xl text-amber-500 border border-amber-600/30">
                    <span class="material-symbols-outlined text-3xl">school</span>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-stone-200 tracking-wide font-serif">原科解密報告</h2>
                    <p class="text-amber-600/80 text-xs uppercase tracking-[0.2em] font-tech mt-1">Analysis Complete</p>
                </div>
            </div>
            <!-- Body -->
            <div class="p-8 overflow-y-auto space-y-6 scrollbar-hide">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-amber-500 mb-4 flex items-center gap-2 font-serif">
                            <span class="w-1.5 h-6 bg-amber-700 rounded-full block"></span>
                            <span id="edu-report-title"></span>
                        </h3>
                        <div class="text-stone-300 leading-8 text-base text-justify font-light font-serif" id="edu-content"></div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <div class="p-5 bg-stone-950/50 border-t border-white/5 text-center">
                <button class="px-8 py-3 bg-gradient-to-r from-amber-800 to-amber-700 hover:from-amber-700 hover:to-amber-600 text-white font-bold rounded-lg shadow-lg transform transition hover:scale-105 active:scale-95" onclick="closeEduModal()">
                    收錄變因 (Data Collected)
                </button>
            </div>
        </div>
    </div>

    <!-- Source Code Modal -->
    <div class="hidden fixed inset-0 z-[120] bg-black/90 flex items-center justify-center p-4" id="source-modal">
        <div class="glass-modal rounded-xl p-6 max-w-4xl w-full h-[80vh] flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-amber-500">網頁原始碼</h3>
                <div class="flex gap-3">
                    <button onclick="copySource()" class="px-4 py-2 bg-stone-700 hover:bg-stone-600 text-white rounded text-sm font-bold transition-colors">複製代碼</button>
                    <button onclick="closeSource()" class="text-stone-400 hover:text-white"><span class="material-symbols-outlined">close</span></button>
                </div>
            </div>
            <textarea id="source-code-area" class="w-full flex-grow bg-stone-950 text-stone-300 font-mono text-xs p-4 rounded border border-stone-700 focus:outline-none focus:border-amber-500 resize-none" readonly=""></textarea>
        </div>
    </div>

    <!-- Game Logic & Templates -->
    <script>
        // --- 核心資料與變數 (全域變數，確保不丟失) ---
        let gameState = { taxonomy: false, trap: false, pharmacy: false, granary: false, dye: false, river: false, final: false };
        let teamName = "";
        
        let selectedPlant = null;
        let classificationState = { water: null, trap: null, taboo: null };
        let dyeSelection = { plant: null, mordant: null };
        let trapSelection = { mass: 10, height: 50, rope: 'banana' };

        // --- 圖片系統 (Unsplash + Retro Filters) ---
        // 使用真實照片但配合 CSS .retro-img 濾鏡達到手繪/復古效果
        const IMG = {
            JUNCUS: 'https://images.unsplash.com/photo-1596323097334-71277a0c01eb?q=80&w=400&auto=format&fit=crop', // Reeds/Plant
            RATTAN: 'https://images.unsplash.com/photo-1598556776374-297eb09ae8e3?q=80&w=400&auto=format&fit=crop', // Vines/Weaving
            NETTLE: 'https://images.unsplash.com/photo-1533236378408-7243c224b776?q=80&w=400&auto=format&fit=crop', // Green Leaf
            
            TRAP_BG: 'https://images.unsplash.com/photo-1448375240586-dfd8d395ea6c?q=80&w=1000&auto=format&fit=crop', // Forest Floor
            MORTAR: 'https://images.unsplash.com/photo-1626202378368-232f2e77b63e?q=80&w=1000&auto=format&fit=crop', // Stone tool
            GRANARY_BG: 'https://images.unsplash.com/photo-1590786807090-f3832d200762?q=80&w=1000&auto=format&fit=crop', // Wood structure
            
            SHULANG: 'https://images.unsplash.com/photo-1615485925694-a03974d7df33?q=80&w=400&auto=format&fit=crop', // Red Root
            TURMERIC: 'https://images.unsplash.com/photo-1615485290382-441e4d049cb5?q=80&w=400&auto=format&fit=crop', // Yellow Root
            DYE_POT: 'https://images.unsplash.com/photo-1516962241409-a686b2e94174?q=80&w=1000&auto=format&fit=crop', // Clay Pot
            
            RIVER: 'https://images.unsplash.com/photo-1437482078695-73f5ca6c96e2?q=80&w=1000&auto=format&fit=crop', // River
            FINAL: 'https://images.unsplash.com/photo-1544211333-662991e5c2fa?q=80&w=1200&auto=format&fit=crop' // Fire/Torch
        };

        const plants = {
            'juncus': { name: '燈心草 (Juncus)', img: IMG.JUNCUS, zone: 'water' },
            'rattan': { name: '黃藤 (Rattan)', img: IMG.RATTAN, zone: 'trap' },
            'nettle': { name: '咬人貓 (Nettle)', img: IMG.NETTLE, zone: 'taboo' }
        };

        const eduData = {
            taxonomy: { title: "《鄒族獵人的植物分類學》", text: "本關卡靈感來自鄒族科展報告。原住民對植物的分類並非基於花果型態（西方分類學），而是基於<b>「功能」與「棲地」</b>（如編織用、陷阱用）。這在科學上對應了<b>「生態區位 (Ecological Niche)」</b>的概念。" },
            trap: { title: "《MKBB_2.0_Rangay-致命的衝擊力》", text: "本關卡源自泰雅族重壓陷阱研究。獵人懂得調整<b>「石頭重量 (m)」</b>與<b>「架設高度 (h)」</b>來控制衝擊力。這完美體現了物理學中<b>重力位能轉動能 (Ug = mgh)</b> 的應用。" },
            pharmacy: { title: "《布農族石菖蒲運用探討》", text: "耆老堅持「用酒」處理石菖蒲，在化學上即是利用<b>「有機溶劑萃取」</b>原理。石菖蒲中的有效成分（如 α-细辛醚）是脂溶性的，難溶於水，故水煮效果不佳。" },
            granary: { title: "《穀倉科學，建築泰雅》", text: "防鼠板 (Tku) 的設計是物理學<b>「靜摩擦力與斜面」</b>的經典應用。角度過小，摩擦力大，老鼠易爬；角度過大，正向力減小，老鼠會滑落。" },
            dye: { title: "《semingilj_大地借我的色彩》", text: "排灣族泥染的黑色秘密，在於化學上的<b>「錯合物沈澱」</b>。泥土中富含的<b>鐵離子 (Fe)</b> 與薯榔中的<b>單寧酸 (Tannin)</b> 結合，產生深黑色的丹寧鐵沈澱。" },
            river: { title: "《walo’科研社》&《Klapay》", text: "清潔力不等於泡沫多寡。本關卡展示了科展中最重要的精神：<b>「定義變因」</b>。將主觀的「洗得很乾淨」轉化為客觀的<b>「量化數據」</b>（如油漬殘留面積），是科學探究的基礎。" }
        };

        // --- TTS Engine ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                const zhVoice = voices.find(v => v.lang.includes('zh') && v.name.includes('Google')) || voices.find(v => v.lang.includes('zh'));
                if (zhVoice) utterance.voice = zhVoice;
                utterance.rate = 0.95;
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- 關卡模板 ---
        const levels = {
            taxonomy: `
                <div class="space-y-8 animate-slide-up">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-emerald-500 mb-2 font-serif">分類者的迷宮</h2>
                        <p class="text-stone-400 text-sm italic font-serif">「萬物皆有其所。請將散落的採集樣本歸位。」</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 select-none">
                        <div id="zone-water" onclick="placeInZone('water')" class="drop-zone glass-modal rounded-xl p-5 flex flex-col items-center justify-start gap-3 cursor-pointer hover:border-sky-500/50 hover:bg-sky-900/10 group relative overflow-hidden">
                            <div class="absolute inset-0 bg-sky-500/5 group-hover:bg-sky-500/10 transition-colors"></div>
                            <span class="material-symbols-outlined text-sky-500 text-4xl mb-1">water_drop</span>
                            <h3 class="text-sky-400 font-bold text-lg relative z-10 font-serif">水邊 / 編織</h3>
                            <div id="content-water" class="w-full flex-grow flex items-center justify-center min-h-[100px] text-xs text-stone-500 border border-dashed border-stone-700 rounded-lg bg-black/20 relative z-10 font-serif">(點擊此處放置)</div>
                        </div>
                        <div id="zone-trap" onclick="placeInZone('trap')" class="drop-zone glass-modal rounded-xl p-5 flex flex-col items-center justify-start gap-3 cursor-pointer hover:border-amber-500/50 hover:bg-amber-900/10 group relative overflow-hidden">
                            <div class="absolute inset-0 bg-amber-500/5 group-hover:bg-amber-500/10 transition-colors"></div>
                            <span class="material-symbols-outlined text-amber-500 text-4xl mb-1">hardware</span>
                            <h3 class="text-amber-400 font-bold text-lg relative z-10 font-serif">陷阱 / 強韌</h3>
                            <div id="content-trap" class="w-full flex-grow flex items-center justify-center min-h-[100px] text-xs text-stone-500 border border-dashed border-stone-700 rounded-lg bg-black/20 relative z-10 font-serif">(點擊此處放置)</div>
                        </div>
                        <div id="zone-taboo" onclick="placeInZone('taboo')" class="drop-zone glass-modal rounded-xl p-5 flex flex-col items-center justify-start gap-3 cursor-pointer hover:border-red-500/50 hover:bg-red-900/10 group relative overflow-hidden">
                            <div class="absolute inset-0 bg-red-500/5 group-hover:bg-red-500/10 transition-colors"></div>
                            <span class="material-symbols-outlined text-red-500 text-4xl mb-1">warning</span>
                            <h3 class="text-red-400 font-bold text-lg relative z-10 font-serif">禁忌 / 危險</h3>
                            <div id="content-taboo" class="w-full flex-grow flex items-center justify-center min-h-[100px] text-xs text-stone-500 border border-dashed border-stone-700 rounded-lg bg-black/20 relative z-10 font-serif">(點擊此處放置)</div>
                        </div>
                    </div>
                    <div class="glass-modal rounded-xl p-6 border-t-2 border-t-emerald-600/50">
                        <h4 class="text-stone-400 text-xs uppercase tracking-widest mb-6 font-tech">未分類樣本 (Select to Pickup)</h4>
                        <div id="plant-deck" class="flex flex-wrap justify-center gap-8 min-h-[140px]">
                            <div id="card-juncus" onclick="selectPlant('juncus')" class="plant-card w-32 bg-stone-900 p-3 rounded-xl border border-stone-700 hover:border-emerald-500 cursor-pointer group">
                                <div class="overflow-hidden rounded-lg mb-3 h-24 bg-stone-800"><img src="${IMG.JUNCUS}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 retro-img"></div>
                                <div class="text-center text-xs text-stone-300 font-bold font-serif">燈心草</div>
                            </div>
                            <div id="card-rattan" onclick="selectPlant('rattan')" class="plant-card w-32 bg-stone-900 p-3 rounded-xl border border-stone-700 hover:border-emerald-500 cursor-pointer group">
                                <div class="overflow-hidden rounded-lg mb-3 h-24 bg-stone-800"><img src="${IMG.RATTAN}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 retro-img"></div>
                                <div class="text-center text-xs text-stone-300 font-bold font-serif">黃藤</div>
                            </div>
                            <div id="card-nettle" onclick="selectPlant('nettle')" class="plant-card w-32 bg-stone-900 p-3 rounded-xl border border-stone-700 hover:border-emerald-500 cursor-pointer group">
                                <div class="overflow-hidden rounded-lg mb-3 h-24 bg-stone-800"><img src="${IMG.NETTLE}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 retro-img"></div>
                                <div class="text-center text-xs text-stone-300 font-bold font-serif">咬人貓</div>
                            </div>
                        </div>
                    </div>
                    <button onclick="submitTaxonomy()" id="btn-submit-tax" class="w-full py-4 bg-emerald-800/50 hover:bg-emerald-700 text-white font-bold rounded-lg shadow-lg opacity-50 cursor-not-allowed transition-all border border-emerald-600/30 tracking-widest font-serif" disabled>提交分類 (SUBMIT)</button>
                </div>
            `,
            trap: `
                <div class="space-y-6 animate-slide-up">
                    <div class="text-center"><h2 class="text-3xl font-bold text-orange-500 font-serif">重力的陷阱</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                        <!-- Controls -->
                        <div class="md:col-span-2 glass-modal p-6 rounded-xl border border-stone-700 flex flex-col space-y-6 h-fit">
                            <h3 class="font-bold text-stone-200 border-b border-white/10 pb-2 mb-2 font-tech flex justify-between items-center">
                                SET VARIABLES 
                                <span class="material-symbols-outlined text-orange-500 text-sm">tune</span>
                            </h3>
                            
                            <!-- Mass -->
                            <div>
                                <label class="text-xs text-orange-500 font-bold mb-3 block uppercase tracking-wide font-serif">1. 壓石重量 (Mass)</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <button onclick="setTrapMass(10)" id="mass-10" class="p-2 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all font-mono">10kg</button>
                                    <button onclick="setTrapMass(20)" id="mass-20" class="p-2 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all font-mono">20kg</button>
                                    <button onclick="setTrapMass(30)" id="mass-30" class="p-2 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all font-mono">30kg</button>
                                    <button onclick="setTrapMass(40)" id="mass-40" class="p-2 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all font-mono">40kg</button>
                                </div>
                            </div>

                            <!-- Height -->
                            <div>
                                <label class="flex justify-between text-xs text-orange-500 font-bold mb-3 uppercase tracking-wide font-serif"><span>2. 架設高度 (Height)</span><span id="trap-height-val" class="font-mono text-white">50 cm</span></label>
                                <input type="range" id="trap-height" min="50" max="150" step="25" value="50" class="w-full h-2 bg-stone-800 rounded-lg cursor-pointer accent-orange-500 appearance-none" oninput="setTrapHeight(this.value)">
                                <div class="flex justify-between text-[10px] text-stone-500 mt-2 font-mono"><span>LOW</span><span>HIGH</span></div>
                            </div>

                            <!-- Material -->
                            <div>
                                <label class="text-xs text-orange-500 font-bold mb-3 block uppercase tracking-wide font-serif">3. 繩索材質 (Material)</label>
                                <div class="flex gap-3">
                                    <button onclick="setTrapRope('banana')" id="rope-banana" class="flex-1 p-3 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all flex flex-col items-center gap-1">
                                        <span class="material-symbols-outlined text-sm text-lime-400">eco</span>
                                        <span class="text-stone-300 font-serif">香蕉絲</span>
                                    </button>
                                    <button onclick="setTrapRope('rattan')" id="rope-rattan" class="flex-1 p-3 bg-stone-800 rounded-lg text-xs hover:bg-stone-700 border border-stone-600 transition-all flex flex-col items-center gap-1">
                                        <span class="material-symbols-outlined text-sm text-amber-600">radio_button_checked</span>
                                        <span class="text-stone-300 font-serif">黃藤芯</span>
                                    </button>
                                </div>
                            </div>

                            <button onclick="triggerTrap()" class="w-full bg-gradient-to-r from-orange-800 to-orange-700 hover:from-orange-700 hover:to-orange-600 text-white font-bold py-3.5 rounded-lg shadow-lg transition-transform active:scale-95 mt-2 border border-white/10 font-serif">設置陷阱 (DEPLOY)</button>
                        </div>

                        <!-- Visualization -->
                        <div class="md:col-span-3 bg-black rounded-xl border border-stone-700 relative h-[400px] overflow-hidden shadow-inner group">
                            <!-- Background Image -->
                            <img src="${IMG.TRAP_BG}" class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-70 transition-opacity duration-700 retro-img">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                            
                            <!-- Dynamic Trap Mechanism -->
                            <div id="trap-mechanism" class="absolute left-1/2 -translate-x-1/2 transition-all duration-300 origin-top shadow-lg" style="top: 0; width: 6px; background: #854d0e; height: 100px;"></div>
                            <div id="trap-rock" class="absolute left-1/2 -translate-x-1/2 w-24 bg-stone-600 rounded-lg border-b-4 border-stone-800 flex items-center justify-center text-xs text-white font-bold z-20 transition-all duration-300 shadow-2xl" style="top: 100px; height: 50px; box-shadow: 0 10px 20px rgba(0,0,0,0.5);">
                                <span id="rock-label" class="font-mono">10kg</span>
                            </div>

                            <!-- Boar (Enhanced SVG) -->
                            <div id="boar" class="absolute bottom-4 left-[-150px] w-40 h-24 z-10 opacity-0 filter drop-shadow-lg">
                                <svg viewBox="0 0 100 60" class="w-full h-full fill-stone-300">
                                    <path d="M10,35 Q15,10 40,15 T80,20 L95,35 L90,55 L80,50 L75,55 L30,55 L25,50 L10,50 Z" />
                                    <circle cx="85" cy="25" r="2" fill="black" />
                                    <path d="M82,55 L88,55" stroke="white" stroke-width="2" /> 
                                    <path d="M25,35 L35,45" stroke="black" stroke-width="1" opacity="0.3"/>
                                </svg>
                            </div>

                            <!-- Status HUD -->
                            <div class="absolute top-4 right-4 bg-stone-950/80 backdrop-blur border border-white/10 px-4 py-2 rounded-lg text-right pointer-events-none">
                                <div class="text-[9px] text-orange-500 uppercase tracking-widest font-tech">SYSTEM STATUS</div>
                                <div id="trap-status" class="text-base font-mono text-emerald-500 animate-pulse">STANDBY</div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            pharmacy: `
                <div class="space-y-8 animate-slide-up">
                    <div class="text-center"><h2 class="text-3xl font-bold text-purple-400 font-serif">石菖蒲煉金術</h2></div>
                    <div class="glass-modal p-0 rounded-2xl border border-white/10 max-w-2xl mx-auto overflow-hidden shadow-2xl">
                        <div class="relative h-56">
                            <img src="${IMG.MORTAR}" class="w-full h-full object-cover retro-img">
                            <div class="absolute inset-0 bg-gradient-to-t from-stone-900 to-transparent"></div>
                            <div class="absolute bottom-4 left-6 right-6">
                                <p class="text-stone-200 text-lg font-serif italic leading-relaxed">「實驗失敗... 水煮的石菖蒲無法抑制細菌。耆老說：『要用酒，酒才能引出它的靈魂。』」</p>
                            </div>
                        </div>
                        
                        <div class="p-8 bg-stone-900/80">
                            <h3 class="text-xs text-purple-400 font-bold uppercase tracking-widest mb-4 font-tech">Select Extraction Method</h3>
                            <div class="grid grid-cols-1 gap-4">
                                <button onclick="checkPharmacy(false)" class="group p-4 bg-stone-800 hover:bg-stone-700 rounded-xl text-left border border-stone-700 transition-all flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-blue-900/50 flex items-center justify-center text-blue-400 font-bold border border-blue-500/30">A</div>
                                    <div><span class="font-bold text-white block group-hover:text-blue-300 font-serif">用水煮 (Water Boiling)</span><span class="text-xs text-stone-500">極性溶劑 / 100°C</span></div>
                                </button>
                                <button onclick="checkPharmacy(true)" class="group p-4 bg-stone-800 hover:bg-stone-700 rounded-xl text-left border border-stone-700 hover:border-purple-500 transition-all flex items-center gap-4 relative overflow-hidden">
                                    <div class="absolute inset-0 bg-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                    <div class="w-10 h-10 rounded-full bg-purple-900/50 flex items-center justify-center text-purple-400 font-bold border border-purple-500/30 relative z-10">B</div>
                                    <div class="relative z-10"><span class="font-bold text-white block group-hover:text-purple-300 font-serif">用酒精泡 (Alcohol Extraction)</span><span class="text-xs text-stone-500">有機溶劑 / 萃取精油</span></div>
                                </button>
                                <button onclick="checkPharmacy(false)" class="group p-4 bg-stone-800 hover:bg-stone-700 rounded-xl text-left border border-stone-700 transition-all flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-full bg-stone-700 flex items-center justify-center text-stone-400 font-bold border border-stone-500/30">C</div>
                                    <div><span class="font-bold text-white block group-hover:text-stone-300 font-serif">直接搗碎 (Physical Crush)</span><span class="text-xs text-stone-500">物理破壞 / 表面接觸</span></div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            granary: `
                <div class="space-y-6 animate-slide-up">
                    <div class="text-center"><h2 class="text-3xl font-bold text-yellow-500 font-serif">會呼吸的穀倉</h2><p class="text-stone-400 text-sm">調整防鼠板(Tku)的角度，防止鼠害。</p></div>
                    <div class="glass-modal rounded-2xl p-6 border border-white/10 shadow-2xl">
                        <div class="flex flex-col md:flex-row gap-8">
                            <div class="w-full md:w-1/2 relative bg-stone-950 rounded-xl overflow-hidden border border-stone-700 h-80 flex items-center justify-center shadow-inner">
                                <img src="${IMG.GRANARY_BG}" class="absolute inset-0 w-full h-full object-cover opacity-30 grayscale retro-img">
                                <div class="relative z-10 text-center flex flex-col items-center">
                                    <!-- Post -->
                                    <div class="w-6 h-40 bg-stone-700 rounded-sm relative shadow-xl"></div>
                                    <!-- Rat Guard -->
                                    <div id="rat-guard-visual" class="w-40 h-3 bg-yellow-600 absolute top-10 rounded-full shadow-lg transition-transform duration-500 origin-center flex items-center justify-center">
                                        <div class="w-2 h-2 bg-yellow-800 rounded-full"></div>
                                    </div>
                                    <!-- Rat -->
                                    <div id="rat-container" class="absolute bottom-0 transition-all duration-1000 opacity-0 transform translate-y-10">
                                        <span class="material-symbols-outlined text-stone-400 text-4xl drop-shadow-md">pest_control_rodent</span>
                                    </div>
                                </div>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col justify-center space-y-8 px-4">
                                <div>
                                    <h3 class="text-xl font-bold text-yellow-500 mb-2 font-tech flex items-center gap-2"><span class="material-symbols-outlined">straighten</span> ANGLE CALIBRATION</h3>
                                    <p class="text-sm text-stone-400 leading-relaxed">老鼠正嘗試爬上柱子。請利用<span class="font-bold text-yellow-200">摩擦力原理 (Friction)</span>，調整防鼠板至最佳角度。</p>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-xs text-stone-500 font-mono">FLAT (0°)</span>
                                        <span class="text-xl font-bold text-yellow-500 font-mono" id="angle-display">0°</span>
                                        <span class="text-xs text-stone-500 font-mono">STEEP (90°)</span>
                                    </div>
                                    <input type="range" id="angle-slider" min="0" max="90" step="15" value="0" class="w-full h-3 bg-stone-800 rounded-lg cursor-pointer accent-yellow-500 appearance-none border border-stone-600" oninput="updateGranaryUI()">
                                </div>
                                <button onclick="testGranary()" class="w-full bg-yellow-800 hover:bg-yellow-700 text-white font-bold py-4 rounded-xl shadow-lg transition-all border border-white/10 hover:shadow-yellow-900/50 font-serif">執行模擬 (SIMULATE)</button>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            dye: `
                <div class="space-y-8 animate-slide-up">
                    <div class="text-center"><h2 class="text-3xl font-bold text-pink-500 font-serif">大地調色盤</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Controls -->
                        <div class="glass-modal p-6 rounded-2xl border border-white/10 space-y-8 h-fit">
                            <div>
                                <h3 class="text-xs text-stone-400 uppercase font-bold mb-4 font-tech tracking-widest border-b border-white/5 pb-2">Step 1: Select Plant</h3>
                                <div class="flex gap-4">
                                    <div id="dye-p1" onclick="selectDye('plant','shulang')" class="cursor-pointer w-24 h-24 bg-stone-800 rounded-xl border border-stone-600 hover:border-pink-500 hover:bg-pink-900/10 flex flex-col items-center justify-center p-2 transition-all group">
                                        <img src="${IMG.SHULANG}" class="w-12 h-12 object-cover rounded-full mb-2 border border-white/10 retro-img">
                                        <span class="text-[10px] text-stone-300 font-serif">薯榔 (Tannin)</span>
                                    </div>
                                    <div id="dye-p2" onclick="selectDye('plant','turmeric')" class="cursor-pointer w-24 h-24 bg-stone-800 rounded-xl border border-stone-600 hover:border-yellow-500 hover:bg-yellow-900/10 flex flex-col items-center justify-center p-2 transition-all group">
                                        <img src="${IMG.TURMERIC}" class="w-12 h-12 object-cover rounded-full mb-2 border border-white/10 retro-img">
                                        <span class="text-[10px] text-stone-300 font-serif">薑黃 (Curcumin)</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xs text-stone-400 uppercase font-bold mb-4 font-tech tracking-widest border-b border-white/5 pb-2">Step 2: Select Mordant</h3>
                                <div class="flex gap-4">
                                    <div id="dye-m1" onclick="selectDye('mordant','lime')" class="cursor-pointer w-24 h-24 bg-stone-800 rounded-xl border border-stone-600 hover:border-white hover:bg-stone-700 flex flex-col items-center justify-center p-2 transition-all">
                                        <div class="w-10 h-10 rounded-full bg-stone-200 mb-2 border border-white/20 shadow-inner"></div>
                                        <span class="text-[10px] text-stone-300 font-serif">石灰水 (Ca)</span>
                                    </div>
                                    <div id="dye-m2" onclick="selectDye('mordant','mud')" class="cursor-pointer w-24 h-24 bg-stone-800 rounded-xl border border-stone-600 hover:border-stone-500 hover:bg-stone-900/10 flex flex-col items-center justify-center p-2 transition-all">
                                        <div class="w-10 h-10 rounded-full bg-stone-600 mb-2 border border-black/20 shadow-inner"></div>
                                        <span class="text-[10px] text-stone-300 font-serif">泥巴水 (Fe)</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="mixDye()" class="w-full bg-pink-800 hover:bg-pink-700 text-white font-bold py-4 rounded-xl mt-2 shadow-lg transition-all border border-white/10 font-serif">開始化學反應 (MIX)</button>
                        </div>
                        
                        <!-- Visualization -->
                        <div class="flex items-center justify-center bg-black/40 rounded-2xl relative h-full min-h-[350px] border border-white/5 shadow-inner">
                            <div class="relative w-64 h-64">
                                <img src="${IMG.DYE_POT}" class="absolute inset-0 w-full h-full object-contain z-20 drop-shadow-2xl retro-img">
                                <!-- Liquid Layer -->
                                <div id="dye-liquid" class="absolute bottom-8 left-16 right-12 top-24 bg-stone-800 rounded-b-full opacity-90 z-10 transition-colors duration-1000 blur-sm mix-blend-multiply"></div>
                                <!-- Steam Effect -->
                                <div class="absolute -top-10 left-1/2 -translate-x-1/2 w-20 h-20 bg-white/10 blur-xl rounded-full animate-pulse z-0 opacity-50"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            river: `
                <div class="space-y-8 animate-slide-up">
                    <div class="text-center"><h2 class="text-3xl font-bold text-cyan-500 font-serif">溪邊的泡沫之戰</h2></div>
                    <div class="glass-modal rounded-2xl border border-white/10 overflow-hidden max-w-3xl mx-auto shadow-2xl">
                        <div class="relative h-64 bg-cyan-950 cursor-pointer group overflow-hidden" onclick="revealSoap()">
                            <img src="${IMG.RIVER}" class="w-full h-full object-cover opacity-60 group-hover:opacity-40 group-hover:scale-105 transition-all duration-700 retro-img">
                            <div class="absolute inset-0 flex flex-col items-center justify-center backdrop-blur-[2px] group-hover:backdrop-blur-none transition-all">
                                <span class="material-symbols-outlined text-5xl text-white mb-2 animate-bounce">touch_app</span>
                                <h3 class="text-2xl font-bold text-white tracking-widest drop-shadow-lg font-serif">點擊進行水質實驗</h3>
                            </div>
                        </div>
                        
                        <div id="soap-data" class="hidden p-8 grid grid-cols-1 md:grid-cols-3 gap-4 bg-stone-950 border-b border-white/5">
                            <div class="p-5 bg-stone-900 rounded-xl border border-stone-700 flex flex-col gap-2">
                                <h4 class="font-bold text-white text-lg font-serif">無患子 (Sapindus)</h4>
                                <div class="h-px w-full bg-white/10"></div>
                                <p class="text-xs text-stone-400 font-mono">泡沫高度: <span class="text-white">12cm</span></p>
                                <p class="text-xs text-stone-400 font-mono">油漬殘留: <span class="text-emerald-400 font-bold text-base">5%</span></p>
                            </div>
                            <div class="p-5 bg-stone-900 rounded-xl border border-stone-700 flex flex-col gap-2">
                                <h4 class="font-bold text-white text-lg font-serif">市售肥皂 (Soap)</h4>
                                <div class="h-px w-full bg-white/10"></div>
                                <p class="text-xs text-stone-400 font-mono">泡沫高度: <span class="text-white">15cm</span></p>
                                <p class="text-xs text-stone-400 font-mono">油漬殘留: <span class="text-emerald-400 font-bold text-base">2%</span></p>
                            </div>
                            <div class="p-5 bg-stone-900 rounded-xl border border-stone-700 flex flex-col gap-2">
                                <h4 class="font-bold text-white text-lg font-serif">清水 (Water)</h4>
                                <div class="h-px w-full bg-white/10"></div>
                                <p class="text-xs text-stone-400 font-mono">泡沫高度: <span class="text-white">0cm</span></p>
                                <p class="text-xs text-stone-400 font-mono">油漬殘留: <span class="text-red-400 font-bold text-base">85%</span></p>
                            </div>
                        </div>
                        
                        <div id="soap-quiz" class="hidden p-8 bg-stone-900/50">
                            <p class="text-cyan-200 text-lg mb-6 font-bold flex items-center gap-2 font-serif"><span class="material-symbols-outlined">quiz</span> 科學思考：如何定義「清潔力」？</p>
                            <div class="space-y-3">
                                <button onclick="checkSoap(1)" class="w-full text-left p-4 rounded-xl bg-stone-800 hover:bg-stone-700 text-stone-300 border border-transparent hover:border-stone-500 transition-all font-serif">1. 看誰產生的泡泡比較多 (Observation)</button>
                                <button onclick="checkSoap(2)" class="w-full text-left p-4 rounded-xl bg-stone-800 hover:bg-cyan-900/30 text-white border border-transparent hover:border-cyan-400 transition-all font-bold shadow-lg font-serif">2. 測量油漬殘留面積 (Quantification)</button>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            final: `
                 <div class="space-y-10 max-w-3xl mx-auto text-center animate-slide-up pb-20">
                    <div>
                        <span class="text-amber-500 text-xs tracking-[0.3em] uppercase border border-amber-500 px-4 py-1.5 rounded-full bg-amber-500/10 font-tech">Final Chapter</span>
                        <h2 class="text-5xl font-bold text-white mt-6 mb-2 drop-shadow-[0_0_20px_rgba(245,158,11,0.5)] font-serif">傳承之火</h2>
                    </div>
                    <div class="glass-modal p-1 rounded-2xl border border-amber-500/30 shadow-[0_0_50px_-10px_rgba(245,158,11,0.2)] relative overflow-hidden">
                         <div class="absolute inset-0 bg-cover bg-center opacity-40 mix-blend-overlay transition-opacity duration-1000 retro-img" style="background-image: url('${IMG.FINAL}');"></div>
                         <div class="absolute inset-0 bg-gradient-to-t from-stone-950 via-stone-950/80 to-transparent"></div>
                         
                         <div class="relative z-10 p-10">
                            <div class="w-20 h-20 bg-red-900/50 rounded-full mx-auto flex items-center justify-center mb-6 border border-red-500/50 shadow-[0_0_30px_rgba(239,68,68,0.3)] animate-pulse">
                                <span class="material-symbols-outlined text-4xl text-red-400">local_fire_department</span>
                            </div>
                            
                            <h3 class="text-3xl font-bold text-red-400 mb-8 font-serif">毒舌守門人的質問</h3>
                            
                            <div class="bg-black/40 backdrop-blur-sm p-8 rounded-xl text-left mb-8 border-l-4 border-red-500 shadow-xl">
                                <p class="text-stone-200 italic font-serif text-xl leading-relaxed">「年輕人，你憑什麼說我們的文化是科學？別用外人的語言，用一句話說服我！」</p>
                            </div>
                            
                            <div class="grid gap-4 text-left">
                                <button onclick="finishGame(false)" class="p-5 bg-stone-800/80 hover:bg-stone-700 border border-stone-600 rounded-xl text-stone-400 transition-all font-serif">
                                    <span class="font-bold block mb-1">A. 因為這是祖靈留下的規定。</span>
                                    <span class="text-xs opacity-60">傳統權威解釋</span>
                                </button>
                                <button onclick="finishGame(true)" class="p-5 bg-gradient-to-r from-stone-800 to-stone-900 hover:from-emerald-900/50 hover:to-emerald-800/50 border border-emerald-500/30 hover:border-emerald-400 rounded-xl text-stone-200 hover:text-white transition-all ring-1 ring-emerald-500/10 hover:ring-emerald-400/50 shadow-lg group font-serif">
                                    <span class="font-bold block mb-1 group-hover:text-emerald-300">B. 我們的文化就是生存的數據庫。</span>
                                    <span class="text-xs text-stone-400 group-hover:text-emerald-200/70">防鼠板利用<span class="text-emerald-400 font-bold">摩擦力</span>，燻飛魚利用<span class="text-emerald-400 font-bold">脫水原理</span>。這就是科學。</span>
                                </button>
                            </div>
                         </div>
                    </div>
                </div>
            `
        };

        // --- Logic Functions ---
        function startGame() {
            if(!document.getElementById('team-name').value) return;
            teamName = document.getElementById('team-name').value;
            document.getElementById('team-display').innerText = teamName;
            document.getElementById('team-display').classList.remove('animate-pulse', 'text-emerald-500/80');
            document.getElementById('team-display').classList.add('text-amber-400');
            
            // Transition
            document.getElementById('stage-login').classList.add('hidden');
            document.getElementById('stage-map').classList.remove('hidden');
            speak(`獵人小隊 ${teamName}，權限已開通。請選擇區域進行解密。`);
        }

        function enterLevel(id) {
            if(id === 'final' && !isFinalUnlocked()) { showModal(false, "權限不足 (ACCESS DENIED)", "請先完成所有前置科學關卡以解鎖最終試煉。"); return; }
            
            // Reset States
            if(id === 'taxonomy') { selectedPlant = null; classificationState = { water: null, trap: null, taboo: null }; }
            if(id === 'trap') { setTimeout(() => { setTrapMass(10); setTrapRope('banana'); setTrapHeight(50); }, 100); }
            if(id === 'dye') { dyeSelection = { plant: null, mordant: null }; }
            if(id === 'granary') { setTimeout(()=> document.getElementById('angle-display').innerText = "0°", 100); }

            document.getElementById('stage-map').classList.add('hidden');
            document.getElementById('level-container').classList.remove('hidden');
            document.getElementById('level-content').innerHTML = levels[id];
            window.scrollTo(0,0);
        }

        function returnToMap() {
            document.getElementById('level-container').classList.add('hidden');
            document.getElementById('stage-map').classList.remove('hidden');
            updateMapStatus();
        }

        function updateMapStatus() {
            let completedCount = 0;
            for(let key in gameState) {
                if(gameState[key] && key !== 'final') {
                    document.getElementById(`check-${key}`).classList.remove('hidden');
                    // Style update for completed nodes
                    const btn = document.getElementById(`btn-${key}`);
                    btn.classList.add('border-emerald-500/50', 'bg-emerald-900/20');
                    completedCount++;
                }
            }
            
            // Unlock Final
            if(isFinalUnlocked()) {
                const btn = document.getElementById('btn-final');
                btn.classList.remove('locked');
                btn.classList.add('cursor-pointer', 'ring-2', 'ring-amber-500', 'animate-pulse');
                document.getElementById('final-bg').classList.remove('grayscale', 'opacity-20');
                document.getElementById('final-bg').classList.add('opacity-60');
                
                document.getElementById('final-icon').innerText = "lock_open";
                document.getElementById('final-icon').classList.add('text-amber-400');
                document.getElementById('final-icon-container').classList.add('bg-amber-900/80', 'border-amber-500');
                
                document.getElementById('final-text').innerText = "最終試煉：開啟";
                document.getElementById('final-text').classList.replace('text-stone-500', 'text-amber-400');
            }
            
            // Progress Bar
            const progress = (completedCount / 6) * 100;
            document.getElementById('global-progress').style.width = `${progress}%`;
        }

        function isFinalUnlocked() { return gameState.taxonomy && gameState.trap && gameState.pharmacy && gameState.granary && gameState.dye && gameState.river; }

        // --- UI Feedback ---
        function showModal(success, title, msg) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            const icon = document.getElementById('modal-icon');
            const iconBg = document.getElementById('modal-icon-bg');
            const titleEl = document.getElementById('modal-title');
            
            modal.classList.remove('hidden');
            // Animation reset
            void content.offsetWidth; 
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');

            if(success) {
                icon.innerHTML = '<span class="material-symbols-outlined text-4xl text-emerald-400">verified</span>';
                iconBg.className = "w-20 h-20 rounded-full bg-emerald-900/30 flex items-center justify-center border border-emerald-500/30 shadow-[0_0_20px_rgba(16,185,129,0.2)]";
                titleEl.innerText = title;
                titleEl.className = "text-2xl font-bold text-center mb-3 tracking-wide text-emerald-400 font-serif";
            } else {
                icon.innerHTML = '<span class="material-symbols-outlined text-4xl text-red-400">error</span>';
                iconBg.className = "w-20 h-20 rounded-full bg-red-900/30 flex items-center justify-center border border-red-500/30 shadow-[0_0_20px_rgba(239,68,68,0.2)]";
                titleEl.innerText = title;
                titleEl.className = "text-2xl font-bold text-center mb-3 tracking-wide text-red-400 font-serif";
            }
            document.getElementById('modal-body').innerHTML = msg;
        }

        function closeModal() {
            const content = document.getElementById('modal-content');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => document.getElementById('modal').classList.add('hidden'), 200);
        }

        function showEduModal(levelId) {
            const data = eduData[levelId];
            document.getElementById('edu-modal').classList.remove('hidden');
            document.getElementById('edu-report-title').innerText = data.title;
            document.getElementById('edu-content').innerHTML = data.text;
        }
        function closeEduModal() {
            document.getElementById('edu-modal').classList.add('hidden');
            returnToMap();
        }
        function completeLevel(id) {
            gameState[id] = true;
            closeModal();
            setTimeout(() => showEduModal(id), 400);
        }

        // --- Logic: Taxonomy ---
        function selectPlant(id) {
            document.querySelectorAll('.plant-card').forEach(e => e.classList.remove('selected'));
            selectedPlant = id;
            document.getElementById(`card-${id}`).classList.add('selected');
        }
        function placeInZone(zone) {
            if(!selectedPlant) { // Withdraw logic
                if(classificationState[zone]) {
                    document.getElementById(`card-${classificationState[zone]}`).classList.remove('hidden');
                    classificationState[zone] = null;
                    renderZone(zone);
                    checkTaxReady();
                }
                return;
            }
            // Remove from other zones if needed
            if(Object.values(classificationState).includes(selectedPlant)) {
                 for(let z in classificationState) if(classificationState[z]===selectedPlant) { classificationState[z]=null; renderZone(z); }
            }
            classificationState[zone] = selectedPlant;
            document.getElementById(`card-${selectedPlant}`).classList.add('hidden');
            selectedPlant = null;
            renderZone(zone);
            checkTaxReady();
        }
        function renderZone(zone) {
            const pid = classificationState[zone];
            const el = document.getElementById(`content-${zone}`);
            if(pid) {
                el.innerHTML = `<div class="w-full h-full bg-stone-800 rounded-lg p-2 flex items-center gap-3 animate-slide-up border border-stone-600 shadow-lg"><img src="${plants[pid].img}" class="w-10 h-10 rounded object-cover retro-img"><span class="text-sm text-white font-bold font-serif">${plants[pid].name.split(' ')[0]}</span></div>`;
                el.classList.remove('border-dashed', 'bg-black/20');
            } else {
                el.innerHTML = `(點擊此處放置)`;
                el.classList.add('border-dashed', 'bg-black/20');
            }
        }
        function checkTaxReady() {
            const ready = Object.values(classificationState).every(x=>x);
            const btn = document.getElementById('btn-submit-tax');
            btn.disabled = !ready;
            if(ready) {
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.classList.add('bg-emerald-600', 'hover:bg-emerald-500', 'shadow-emerald-900/50');
            } else {
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                btn.classList.remove('bg-emerald-600', 'hover:bg-emerald-500', 'shadow-emerald-900/50');
            }
        }
        function submitTaxonomy() {
            if(classificationState.water==='juncus' && classificationState.trap==='rattan' && classificationState.taboo==='nettle') {
                showModal(true, "分類正確 (CORRECT)", "你成功還原了鄒族的植物邏輯。<br>燈心草生於水邊，黃藤強韌用於陷阱，咬人貓具危險性屬禁忌。");
                setTimeout(()=>completeLevel('taxonomy'), 1500);
            } else {
                showModal(false, "分類邏輯錯誤", "提示：<br>1. 誰生長在水邊？<br>2. 誰最堅韌適合做陷阱？<br>3. 誰會咬人？");
            }
        }

        // --- Logic: Trap ---
        function setTrapMass(m) {
            trapSelection.mass = m;
            document.querySelectorAll('[id^="mass-"]').forEach(el => {
                el.classList.remove('bg-orange-600', 'text-white', 'ring-2', 'ring-orange-400');
                el.classList.add('bg-stone-800');
            });
            const active = document.getElementById(`mass-${m}`);
            active.classList.remove('bg-stone-800');
            active.classList.add('bg-orange-600', 'text-white', 'ring-2', 'ring-orange-400');
            
            // Visual update
            const rock = document.getElementById('trap-rock');
            document.getElementById('rock-label').innerText = m + "kg";
            rock.style.width = (60 + m) + "px"; // Size scaling
            rock.style.height = (30 + m/2) + "px";
        }
        function setTrapHeight(h) {
            trapSelection.height = parseInt(h);
            document.getElementById('trap-height-val').innerText = h + " cm";
            // Map 50-150cm to visual top 150px -> 50px
            const maxTop = 150;
            const minTop = 30;
            const visualTop = maxTop - ((h - 50) / 100) * (maxTop - minTop);
            document.getElementById('trap-rock').style.top = visualTop + "px";
            document.getElementById('trap-mechanism').style.height = visualTop + "px";
        }
        function setTrapRope(type) {
            trapSelection.rope = type;
            document.getElementById('rope-banana').classList.remove('ring-2', 'ring-lime-400', 'bg-stone-700');
            document.getElementById('rope-rattan').classList.remove('ring-2', 'ring-amber-500', 'bg-stone-700');
            
            if(type === 'banana') document.getElementById('rope-banana').classList.add('ring-2', 'ring-lime-400', 'bg-stone-700');
            if(type === 'rattan') document.getElementById('rope-rattan').classList.add('ring-2', 'ring-amber-500', 'bg-stone-700');
            
            document.getElementById('trap-mechanism').style.background = type === 'banana' ? '#a3e635' : '#854d0e';
        }
        function triggerTrap() {
            const rock = document.getElementById('trap-rock');
            const rope = document.getElementById('trap-mechanism');
            const boar = document.getElementById('boar');
            const status = document.getElementById('trap-status');
            const startTop = rock.style.top;
            
            status.innerText = "DETECTING TARGET...";
            status.className = "text-base font-mono text-orange-400 animate-pulse";
            
            // 1. Boar Enters
            boar.className = "absolute bottom-4 left-[-150px] w-40 h-24 z-10 boar-anim-enter";
            
            setTimeout(() => {
                status.innerText = "TRIGGERING...";
                status.className = "text-base font-mono text-red-500 font-bold animate-ping";
                
                setTimeout(() => {
                    // 2. Drop Rock
                    rock.style.transition = "top 0.15s cubic-bezier(0.6, 0.04, 0.98, 0.335)";
                    rock.style.top = "280px"; // Ground level
                    rope.style.transition = "height 0.15s cubic-bezier(0.6, 0.04, 0.98, 0.335)";
                    rope.style.height = "280px";

                    setTimeout(() => {
                        // 3. Outcome Calculation
                        let outcome = "miss";
                        if (trapSelection.rope === 'banana' && trapSelection.mass > 20) outcome = "snap";
                        else if (trapSelection.mass >= 30 && trapSelection.height >= 100 && trapSelection.rope === 'rattan') outcome = "catch";
                        else if (trapSelection.mass * trapSelection.height < 1500) outcome = "weak";
                        
                        if (outcome === "snap") {
                            status.innerText = "FAILURE: ROPE SNAP";
                            rope.style.height = "50px"; rope.style.background = "transparent"; // Visual break
                            boar.className = "absolute bottom-4 left-[45%] w-40 h-24 z-10 boar-anim-run";
                            showModal(false, "繩索斷裂！", "香蕉絲太脆弱，無法承受大石頭的瞬間張力 (Tension)。<br>請改用更強韌的黃藤。");
                            resetTrap(startTop);
                        } else if (outcome === "weak") {
                            status.innerText = "FAILURE: IMPACT LOW";
                            boar.className = "absolute bottom-4 left-[45%] w-40 h-24 z-10 boar-anim-run"; 
                            showModal(false, "獵物逃脫", "衝擊力 (F=ma) 不足，山豬被砸了一下但沒暈，生氣地跑走了。<br>試著增加重量或高度以提升位能 (Ug)。");
                            resetTrap(startTop);
                        } else if (outcome === "catch") {
                            status.innerText = "TARGET NEUTRALIZED";
                            status.className = "text-base font-mono text-emerald-400 font-bold";
                            boar.className = "absolute bottom-4 left-[45%] w-40 h-24 z-10 boar-anim-hit";
                            showModal(true, "捕獲成功", "完美的變因組合！<br>重力位能轉化為動能，且黃藤繩索承受住了衝擊。");
                            setTimeout(()=>completeLevel('trap'), 1500);
                        } else {
                            status.innerText = "FAILURE: MISCONFIG";
                            boar.className = "absolute bottom-4 left-[45%] w-40 h-24 z-10 boar-anim-run";
                            showModal(false, "參數未達標", "重量或高度不足，無法造成有效打擊。");
                            resetTrap(startTop);
                        }
                    }, 200);
                }, 2000); // Wait for sniff animation
            }, 2500); // Wait for walk in
        }
        function resetTrap(startTop) {
            setTimeout(() => {
                const rock = document.getElementById('trap-rock');
                const rope = document.getElementById('trap-mechanism');
                rock.style.transition = "top 0.5s ease-out";
                rock.style.top = startTop;
                rope.style.transition = "height 0.5s ease-out";
                rope.style.height = startTop;
                if(trapSelection.rope === 'banana') rope.style.background = '#a3e635';
                document.getElementById('trap-status').innerText = "RESETTING...";
                document.getElementById('trap-status').className = "text-base font-mono text-emerald-400 animate-pulse";
            }, 1000);
        }

        // --- Logic: Pharmacy ---
        function checkPharmacy(isAlc) {
            if(isAlc) {
                showModal(true, "實驗成功 (SUCCESS)", "酒精成功萃取了脂溶性成分 (Essential Oils)。<br>抑菌圈明顯，驗證了耆老的智慧。");
                setTimeout(()=>completeLevel('pharmacy'), 1500);
            } else {
                showModal(false, "效果微弱", "水無法溶解關鍵的脂溶性成分。<br>細菌依然滋生。");
            }
        }

        // --- Logic: Granary ---
        function updateGranaryUI() {
            const angle = document.getElementById('angle-slider').value;
            document.getElementById('angle-display').innerText = angle + "°";
            document.getElementById('rat-guard-visual').style.transform = `rotate(${angle}deg)`;
        }
        function testGranary() {
            const angle = parseInt(document.getElementById('angle-slider').value);
            const rat = document.getElementById('rat-container');
            
            // Reset position
            rat.style.transition = 'none'; 
            rat.style.bottom='0'; 
            rat.style.opacity='1';
            rat.style.transform = 'translateY(10px)';
            
            setTimeout(()=>{
                rat.style.transition = 'all 1.5s ease-out';
                // Rat climbs up
                rat.style.bottom = '120px'; // Reaches guard
                
                setTimeout(() => {
                    if(angle >= 60) {
                        // Fail to climb (Success for player)
                        rat.style.transition = 'all 0.5s ease-in';
                        rat.style.transform = 'translateY(150px) rotate(180deg)'; // Fall
                        rat.style.opacity = '0';
                        showModal(true, "防鼠成功", "角度大於60度，正向力減少導致摩擦力不足。<br>老鼠滑落！");
                        setTimeout(()=>completeLevel('granary'), 1500);
                    } else {
                        // Climb over (Fail)
                        rat.style.bottom = '200px'; 
                        rat.style.opacity = '0';
                        showModal(false, "防禦失敗", "角度太平緩，摩擦力過大。<br>老鼠輕鬆爬進穀倉了！");
                    }
                }, 1200);
            }, 50);
        }

        // --- Logic: Dye ---
        function selectDye(t, v) {
            dyeSelection[t] = v;
            // Visual Selection Logic
            const p = t==='plant'?'dye-p':'dye-m';
            document.getElementById(p+'1').classList.remove('border-white', 'bg-stone-700', 'ring-2', 'ring-pink-400');
            document.getElementById(p+'2').classList.remove('border-white', 'bg-stone-700', 'ring-2', 'ring-yellow-400');
            
            const id = (v==='shulang'||v==='lime')?p+'1':p+'2';
            const el = document.getElementById(id);
            el.classList.add('border-white', 'bg-stone-700', 'ring-2');
            if(t==='plant') {
                el.classList.add(v==='shulang' ? 'ring-pink-400' : 'ring-yellow-400');
                // Preview Liquid Color change based on plant
                document.getElementById('dye-liquid').style.backgroundColor = v==='shulang' ? '#be185d' : '#ca8a04';
            }
        }
        function mixDye() {
            if(!dyeSelection.plant || !dyeSelection.mordant) return;
            const liquid = document.getElementById('dye-liquid');
            
            liquid.style.transition = "background-color 2s ease";
            
            if(dyeSelection.plant==='shulang' && dyeSelection.mordant==='mud') {
                liquid.style.backgroundColor = '#0f172a'; // Deep Black/Blue
                setTimeout(() => {
                    showModal(true, "顏色正確 (BLACK)", "化學反應成功：<br>單寧酸 (Tannin) + 鐵離子 (Fe) = 黑色錯合物");
                    setTimeout(()=>completeLevel('dye'), 1500);
                }, 2000);
            } else {
                // Wrong combos
                liquid.style.backgroundColor = '#78350f'; // Muddy brown
                showModal(false, "顏色錯誤", "這不是傳統的黑色。<br>提示：你需要含「鐵」的媒染劑來與薯榔反應。");
            }
        }

        // --- Logic: River ---
        function revealSoap() { 
            document.getElementById('soap-data').classList.remove('hidden'); 
            document.getElementById('soap-data').classList.add('animate-slide-up');
            document.getElementById('soap-quiz').classList.remove('hidden'); 
            document.getElementById('soap-quiz').classList.add('animate-slide-up');
        }
        function checkSoap(c) {
            if(c===2) {
                showModal(true, "觀念正確", "科學講求「量化證據」。<br>泡沫多寡是主觀感受，油漬殘留率才是客觀數據。");
                setTimeout(()=>completeLevel('river'), 1500);
            } else {
                showModal(false, "觀念偏誤", "泡沫多不代表清潔力強。<br>許多界面活性劑泡沫很少但去污力極強。");
            }
        }

        // --- Logic: Final ---
        function finishGame(s) {
            if(s) {
                document.getElementById('level-content').innerHTML = `
                    <div class="text-center py-20 fade-in relative">
                        <div class="absolute inset-0 flex items-center justify-center -z-10">
                            <div class="w-96 h-96 bg-amber-500/20 rounded-full blur-[100px] animate-pulse"></div>
                        </div>
                        <h2 class="text-6xl text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-yellow-500 font-bold mb-6 drop-shadow-lg font-serif">傳承解鎖</h2>
                        <div class="text-stone-300 text-xl font-serif mb-12">「科學是傳統的翻譯。你已找回失落的變因。」</div>
                        
                        <div class="p-8 bg-white inline-block rounded-2xl shadow-[0_0_50px_rgba(255,255,255,0.2)] transform hover:scale-105 transition-transform duration-500">
                            <span class="material-symbols-outlined text-8xl text-stone-900">qr_code_2</span>
                        </div>
                        <br>
                        <button onclick="resetGame()" class="mt-12 text-stone-500 hover:text-white underline transition-colors font-tech tracking-widest">RESTART SYSTEM</button>
                    </div>`;
                gameState.final = true;
                updateMapStatus(); // To force final progress bar
            } else {
                showModal(false, "回答錯誤", "守門人搖了搖頭。<br>「如果你只會說那是規定，文化就會死在博物館裡。」");
            }
        }

        // --- View Source Logic ---
        function viewSource() {
            const htmlContent = document.documentElement.outerHTML;
            document.getElementById('source-code-area').value = htmlContent;
            document.getElementById('source-modal').classList.remove('hidden');
        }
        function closeSource() {
            document.getElementById('source-modal').classList.add('hidden');
        }
        function copySource() {
            const textArea = document.getElementById('source-code-area');
            textArea.select();
            document.execCommand('copy');
            alert('原始碼已複製！');
        }

        // --- Reset ---
        function resetGame() {
            gameState = { taxonomy: false, trap: false, pharmacy: false, granary: false, dye: false, river: false, final: false };
            teamName = "";
            classificationState = { water: null, trap: null, taboo: null };
            selectedPlant = null;
            dyeSelection = { plant: null, mordant: null };
            trapSelection = { mass: 10, height: 50, rope: 'banana' };

            document.getElementById('team-display').innerText = "OFFLINE";
            document.getElementById('team-display').classList.remove('text-amber-400');
            document.getElementById('global-progress').style.width = "0%";

            const checks = ['taxonomy', 'trap', 'pharmacy', 'granary', 'dye', 'river'];
            checks.forEach(c => document.getElementById(`check-${c}`).classList.add('hidden'));
            
            // Reset Map Nodes Style
            document.querySelectorAll('.map-node').forEach(node => {
                node.classList.remove('border-emerald-500/50', 'bg-emerald-900/20');
            });

            const btnFinal = document.getElementById('btn-final');
            btnFinal.classList.add('locked');
            btnFinal.classList.remove('cursor-pointer', 'ring-2', 'ring-amber-500', 'animate-pulse');
            document.getElementById('final-bg').classList.add('grayscale', 'opacity-20');
            document.getElementById('final-bg').classList.remove('opacity-60');
            
            document.getElementById('final-icon').innerText = "lock";
            document.getElementById('final-icon').classList.remove('text-amber-400');
            document.getElementById('final-icon-container').classList.remove('bg-amber-900/80', 'border-amber-500');
            
            document.getElementById('final-text').innerText = "海神的試煉";
            document.getElementById('final-text').classList.replace('text-amber-400', 'text-stone-500');

            document.getElementById('level-container').classList.add('hidden');
            document.getElementById('stage-map').classList.add('hidden');
            document.getElementById('stage-login').classList.remove('hidden');
            document.getElementById('team-name').value = "";
        }
    </script>

</body></html>